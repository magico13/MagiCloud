@page "/"
@using MagiCommon
@using MagiCommon.Models
@using Microsoft.Extensions.Logging

@inject IMagiCloudAPI MagicApi
@inject ILogger<Index> Logger

<Login OnSuccessfulLogin="@OnFilesChanged">
    <Upload OnUploadComplete="@OnFilesChanged" CurrentDirectory="@CurrentFolder"/>
    <SearchBar OnSearch="@OnSearch"/>
    <FilesComponent FileList="@Files" OnFolderChanged="@OnFolderChanged"/>
</Login>

@code
{
    private string CurrentFolder { get; set; }

    private List<SearchResult> Files { get; set; }

    public async Task OnFilesChanged()
    {
        try
        {
            Files = await MagicApi.GetFilesAsync(false);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Failed to update file list.");
        }
    }

    public void OnSearch(List<SearchResult> results)
    {
        Files = results;
    }

    public void OnFolderChanged(string folder)
    {
        CurrentFolder = folder;
    }
}